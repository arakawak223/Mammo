# 実装ロードマップ

---

## 1. フェーズ概要

```
Phase 0          Phase 1           Phase 2             Phase 3
基盤構築          MVP               コアAI機能            拡張機能
──────────── → ──────────────── → ──────────────── → ────────────────
• 環境構築       • F1 詐欺ボタン   • F3 音声アシスタント • F7 統計連動
• 認証基盤       • F2 自動転送     • F5 会話サマリー     • F8 闇バイト
• ペアリング     • F4 アラート     • F6 リモートブロック    チェッカー
• CI/CD         • F9 緊急SOS
                • 高齢者側UI
                • 家族側UI基盤
```

---

## 2. Phase 0: 基盤構築

### 目標
開発基盤を整備し、全フェーズの土台となるインフラ・認証・ペアリング機構を完成させる。

### 成果物

| # | タスク | 詳細 |
|---|--------|------|
| 0-1 | プロジェクト初期化 | React Native (Expo bare workflow) プロジェクト作成、TypeScript設定、ESLint/Prettier |
| 0-2 | バックエンド初期化 | NestJS プロジェクト作成、Prisma設定、DB接続 |
| 0-3 | AI解析サービス初期化 | FastAPI プロジェクト作成、Poetry依存管理 |
| 0-4 | インフラ構築 | Terraform でAWS環境構築（VPC、RDS、ECS、S3、SQS） |
| 0-5 | CI/CD パイプライン | GitHub Actions（テスト、ビルド、デプロイ） |
| 0-6 | 認証システム | ユーザー登録、ログイン、JWT発行・検証、SMS認証 |
| 0-7 | ペアリング機構 | 招待コード生成、QRコード、ペアリングCRUD |
| 0-8 | プッシュ通知基盤 | FCM/APNs統合、デバイストークン管理 |
| 0-9 | DB マイグレーション | 主要テーブル作成（users, pairings, events, blocked_numbers, sos_settings） |
| 0-10 | iOS制約の早期検証 | iOS実機でCallKit/MessageFilter/BackgroundAudioの動作検証POC |
| 0-11 | 法務・外部連携準備 | 通話録音の法的確認、Google Play SMS/CallLog権限の事前申請準備 |

### 完了条件
- 高齢者と家族がペアリングできる
- プッシュ通知がiOS/Androidに到達する
- CI/CDでステージング環境に自動デプロイされる
- iOS制約の検証結果が文書化され、プラットフォーム戦略が最終確定している

---

## 3. Phase 1: MVP（最小機能製品）

### 目標
最も基本的な防犯機能を実装し、「高齢者の不審状況を家族に通知→家族が確認」のコアループを完成させる。

### 機能と優先度

| 優先度 | 機能 | 理由 |
|--------|------|------|
| ★★★ | F1: 「これ詐欺？」ボタン | コアコンセプトの最小実装。1タップ通報 |
| ★★★ | F4: リアルタイム・アラート | F1の通報を受ける家族側の基盤 |
| ★★☆ | F2: 自動転送機能 | バックグラウンド監視の基本。パッシブな検知 |
| ★★☆ | F9: 緊急SOS | 安全機能は早期に実装すべき。MVP段階では位置情報送信のみ（音声ストリーミングはPhase 2で強化） |

### 詳細タスク

**F1: 「これ詐欺？」ボタン**

| # | タスク |
|---|--------|
| 1-1 | 高齢者側メイン画面UI実装（巨大ボタン） |
| 1-2 | ボタンタップ時のデータ収集（位置情報、直近着信番号） |
| 1-3 | イベント送信API実装 |
| 1-4 | オフライン時キューイング |
| 1-5 | 誤タップ防止（長押し＋キャンセル）UI |

**F2: 自動転送機能**

| # | タスク |
|---|--------|
| 2-1 | Android: 着信検知 BroadcastReceiver 実装 |
| 2-2 | iOS: CXCallObserver 連携 実装 |
| 2-3 | Android: SMS検知 BroadcastReceiver 実装 |
| 2-4 | iOS: MessageFilter Extension 実装 |
| 2-5 | 番号判定ロジック（国際/非通知/未登録） |
| 2-6 | 連絡先照合ロジック |
| 2-7 | SMS詐欺キーワードエンジン（ルールベース） |
| 2-8 | サーバーへのイベント送信 |
| 2-9 | Android Foreground Service 実装 |

**F4: リアルタイム・アラート**

| # | タスク |
|---|--------|
| 4-1 | 家族側ダッシュボード画面実装 |
| 4-2 | アラート一覧・詳細画面実装 |
| 4-3 | プッシュ通知の優先度別配信 |
| 4-4 | 「対応済み」マーク機能 |
| 4-5 | 日次サマリー通知バッチ |

**F9: 緊急SOS（MVP版・デュアルモード対応）**

| # | タスク |
|---|--------|
| 9-1 | SOS発動UI（長押し3秒） |
| 9-2 | 位置情報取得＋継続送信 |
| 9-3 | 家族側の緊急SOS受信画面（地図表示） |
| 9-4 | 緊急プッシュ通知（サイレント解除） |
| 9-5 | キャンセルUI（5秒カウントダウン） |
| 9-6 | 家族側からの解除機能 |
| 9-7 | 110番発信ボタン |
| 9-8 | SOSモード設定（alarm/silent）API＋家族側UI |
| 9-9 | アラームモード実装（大音量鳴動、画面フラッシュ、TTS） |
| 9-10 | サイレントモード実装（完全無音、画面変化なし、バックグラウンド送信） |
| 9-11 | 家族側からのリアルタイムモード切替（WebSocket） |

**その他MVP共通**

| # | タスク |
|---|--------|
| C-1 | 高齢者側ウィジェット（iOS/Android） |
| C-2 | 初期セットアップフロー |
| C-3 | 結合テスト・E2Eテスト |
| C-4 | TestFlight / Google Play 内部テスト配信 |

### 完了条件
- 高齢者が「これ詐欺？」ボタンを押すと家族に通知が届く
- 不審な着信・SMSが自動で家族に通知される
- 緊急SOS発動で位置情報が家族にリアルタイム共有される
- 緊急SOSのアラームモード/サイレントモードが切替可能
- Android版高齢者アプリがフル機能で動作する
- iOS版家族アプリがフル機能で動作する
- 10家族でのクローズドベータテスト実施

---

## 4. Phase 2: コアAI機能

### 目標
AIを活用した高度な分析・自動化機能を追加し、アプリの価値を大幅に向上させる。

### 機能

| 優先度 | 機能 | 理由 |
|--------|------|------|
| ★★★ | F5: 会話サマリー（AI解析） | AI差別化の要。テキスト解析＋スコアリング |
| ★★☆ | F3: AI音声アシスタント | 高齢者の操作負担ゼロへの重要な一歩 |
| ★★☆ | F6: リモート・ブロック | 家族側の「対策実行力」を大幅強化 |
| ★☆☆ | F9強化: 音声ストリーミング | SOSの実用性向上 |

### 詳細タスク

**F5: 会話サマリー（AI解析）**

| # | タスク |
|---|--------|
| 5-1 | AI解析パイプライン構築（FastAPI） |
| 5-2 | LLM プロンプト設計（サマリー生成） |
| 5-3 | 詐欺パターンDB構築（5手口分） |
| 5-4 | スコアリングロジック実装 |
| 5-5 | 家族側の解析結果表示UI |
| 5-6 | 推奨アクション提示ロジック |
| 5-7 | フィードバック機能（「詐欺だった/違った」） |
| 5-8 | 精度評価・チューニング |

**F3: AI音声アシスタント**

| # | タスク |
|---|--------|
| 3-1 | 通話終了検知（Android/iOS） |
| 3-2 | 音声アシスタントUI |
| 3-3 | TTS実装（質問の読み上げ） |
| 3-4 | STT実装（音声応答のテキスト化） |
| 3-5 | 応答解析ロジック（不安検知） |
| 3-6 | 家族通知連携 |
| 3-7 | 発動頻度制御 |

**F6: リモート・ブロック**

| # | タスク |
|---|--------|
| 6-1 | ブロックリスト管理API |
| 6-2 | 家族側のブロックリスト管理UI |
| 6-3 | Android: BlockedNumberContract 連携 |
| 6-4 | iOS: CallDirectory Extension 連携 |
| 6-5 | サーバー↔端末 同期メカニズム |
| 6-6 | 既知詐欺番号DB連携・一括インポート |
| 6-7 | 操作履歴の記録・表示 |

**F9強化: 音声ストリーミング**

| # | タスク |
|---|--------|
| 9-8 | マイク録音＋チャンク送信 |
| 9-9 | WebSocket ストリーミング基盤 |
| 9-10 | 家族側の音声再生UI |
| 9-11 | バッテリー消費最適化 |

### 完了条件
- AI解析で5種類の詐欺パターンを80%以上の精度で判定
- 通話後にAI音声アシスタントが自動起動し、音声のみで操作完結
- 家族がリモートで着信拒否設定を変更でき、30秒以内に反映
- SOSで周囲音声がリアルタイムストリーミングされる

---

## 5. Phase 3: 拡張機能

### 目標
社会課題対応と長期的な価値提供を実現する機能を追加。

### 機能

| 優先度 | 機能 | 理由 |
|--------|------|------|
| ★★☆ | F8: 闇バイトチェッカー | 社会的インパクト大。若年層への訴求 |
| ★☆☆ | F7: 被害額データ連動 | 情報提供の付加価値。データ取得の自動化が課題 |

### 詳細タスク

**F8: 闇バイトチェッカー**

| # | タスク |
|---|--------|
| 8-1 | テキスト入力UI |
| 8-2 | 画像入力 + OCRパイプライン |
| 8-3 | 闇バイトキーワード辞書構築 |
| 8-4 | LLM判定プロンプト設計 |
| 8-5 | リスク判定＋理由提示ロジック |
| 8-6 | 相談先案内表示 |
| 8-7 | （オプション）Web版の公開 |

**F7: 被害額データ連動**

| # | タスク |
|---|--------|
| 7-1 | 警察庁データ取得パイプライン（PDF解析） |
| 7-2 | 都道府県別データ構造化・DB保存 |
| 7-3 | 家族側の統計表示UI（グラフ） |
| 7-4 | 地域別アドバイス生成（LLM） |
| 7-5 | 週次ダイジェスト通知 |
| 7-6 | データ更新の自動化バッチ |

### 完了条件
- 闇バイトチェッカーでテキスト/画像入力から判定結果が返る
- 47都道府県の統計データが閲覧できる
- 地域に応じた防犯アドバイスが表示される

---

## 6. 全体マイルストーン

| マイルストーン | フェーズ | 内容 |
|---------------|---------|------|
| M0: 開発環境完成 | Phase 0 | CI/CD、インフラ、認証、ペアリング、iOS制約検証完了 |
| M0.5: 警察デモ準備 | Phase 0 | 地域警察署（生活安全課）へのデモ資料作成 |
| M1: クローズドα | Phase 1 | F1+F2+F4+F9(デュアルモード) 完成、社内テスト |
| M1.5: 警察フィードバック | Phase 1 | 地域警察署へアプリデモ実施、フィードバック収集 |
| M2: クローズドβ | Phase 1 | 10家族での実地テスト（Android高齢者+iOS家族の構成を含む） |
| M3: AI機能α | Phase 2 | F3+F5+F6+F9(音声ストリーミング) 完成 |
| M4: パブリックβ | Phase 2 | Google Play 先行β公開 + App Store 家族アプリβ公開 |
| M5: 正式リリース v1.0 | Phase 2 | AI精度チューニング完了、安定版。警察庁推奨申請検討 |
| M6: 拡張リリース v1.1 | Phase 3 | F7+F8 追加 |

---

## 7. リスクと緩和策

| リスク | 影響 | 緩和策 |
|--------|------|--------|
| iOS の権限制約が想定以上 | F2/F3/F6 の機能制限 | Phase 0 で早期検証。**Android版をフル機能版として先行リリースし、iOS版は家族管理アプリとして切り分け**。「親Android＋子iPhone」構成をメインターゲットに |
| LLM API のコスト超過 | 運用費用の増大 | 月間利用上限設定、キャッシュ活用、軽量モデルへの切り替え |
| 通話録音の法的リスク | F5 の機能制約 | F3 のテキストベース解析を主軸に。法務確認を Phase 0 で実施 |
| App Store 審査リジェクト | リリース遅延 | Apple ガイドライン事前確認、CallDirectory Extension の審査事例調査 |
| 高齢者の継続利用率が低い | アプリの実効性低下 | 高齢者側は操作不要設計。家族側のエンゲージメント施策に注力 |
| バッテリー消費の苦情 | アンインストール | バッテリー消費の最適化、透明性のある消費量表示 |
| 警察との連携不足 | 公認・推奨を得られない | Phase 0〜1 で地域警察署（生活安全課）へデモ実施。現場フィードバックを機能改善に反映 |

---

## 8. プラットフォーム戦略詳細

### iOS制約を逆手に取るマーケティング

iOS の制限は**「スマホOSだけでは高齢者を守れない。だからこそ家族の力が必要」**というメッセージに転換する。

```
マーケティングメッセージ案：
「iPhoneだけでは、お父さんお母さんを詐欺から守りきれません。
 でも、あなたのスマホと、親のAndroidが繋がれば――
 離れて暮らす家族が、最強の防犯チームになれます。」
```

### プラットフォーム別リリース計画

| フェーズ | Android 高齢者アプリ | iOS 高齢者アプリ | 家族アプリ (iOS/Android) |
|---------|---------------------|-----------------|------------------------|
| Phase 1 MVP | フル機能 | F1（詐欺ボタン）+ F9（緊急SOS）のみ | フル機能 |
| Phase 2 | フル機能 | F1 + F9 + F3（通知起動版） | フル機能 |
| Phase 3 | フル機能 | iOS API進化に応じて段階拡張 | フル機能 |

### ターゲット端末構成

| 構成 | 対応レベル | 備考 |
|------|-----------|------|
| 親:Android ＋ 子:iPhone | **主軸ターゲット** | フル機能。マーケティングの主訴求 |
| 親:Android ＋ 子:Android | フル対応 | |
| 親:iPhone ＋ 子:iPhone | 制限付き対応 | 高齢者側は基本機能のみ。「Androidへの機種変更推奨」を案内 |
| 親:iPhone ＋ 子:Android | 制限付き対応 | 同上 |

---

## 9. 警察連携ロードマップ

本アプリは性質上、警察との親和性が非常に高い。将来的な「警察庁推奨アプリ」を目指し、開発初期から関係構築を進める。

### アクション計画

| タイミング | アクション | 目的 |
|-----------|-----------|------|
| Phase 0 | 地域の警察署（生活安全課）へコンセプト説明 | 現場ニーズのヒアリング、「こういう情報が家族に届くと助かる」のフィードバック |
| Phase 1（M1.5） | 動作するプロトタイプのデモ実施 | 実際の操作感のフィードバック、改善要望の収集 |
| Phase 1 β | クローズドβに警察関係者を招待 | 現場視点でのユーザビリティ評価 |
| Phase 2 | 都道府県警察の生活安全部門へ展開 | 広域での認知拡大、統計データ連携（F7）の協力依頼 |
| Phase 3 | 警察庁への推奨申請 | 「警察庁推奨防犯アプリ」の公認取得を目指す |

### 期待される効果

- 現場のリアルなニーズに基づいた機能改善
- 警察の防犯啓発チャネル（広報誌、防犯教室）を通じたユーザー獲得
- 「警察が認めたアプリ」という信頼性がダウンロード率を大幅向上
- 将来的に110番通報との連携（アプリからの通報時に位置情報を自動共有等）の可能性
